(this["webpackJsonpreact-demo"]=this["webpackJsonpreact-demo"]||[]).push([[0],{14:function(e,t,a){},18:function(e,t,a){},19:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(8),u=a.n(c),o=(a(14),a(1)),i=a(3),l=a.n(i),s=a(2),m=a.n(s),d=a(4),p=a(5);var f=function(e){var t=Object(n.useRef)(null);return Object(n.useEffect)((function(){var a;if(t.current)return null===(a=e.videoTrack)||void 0===a||a.play(t.current),function(){var t;null===(t=e.videoTrack)||void 0===t||t.stop()}}),[t,e.videoTrack]),Object(n.useEffect)((function(){var t;return null===(t=e.audioTrack)||void 0===t||t.play(),function(){var t;null===(t=e.audioTrack)||void 0===t||t.stop()}}),[e.audioTrack]),r.a.createElement("div",{ref:t,className:"video-player",style:{width:"640px",height:"360px"}})},v=(a(18),l.a.createClient({codec:"h264",mode:"rtc"}));var b=function(){var e=function(e){var t=window.location.search,a=new URLSearchParams(t).get(e);return a||""},t=Object(n.useState)(e("appid")),a=Object(o.a)(t,2),c=a[0],u=a[1],i=Object(n.useState)(e("token")),s=Object(o.a)(i,2),b=s[0],h=s[1],k=Object(n.useState)(e("channel")),g=Object(o.a)(k,2),j=g[0],E=g[1],y=function(e){var t=Object(n.useState)(void 0),a=Object(o.a)(t,2),r=a[0],c=a[1],u=Object(n.useState)(void 0),i=Object(o.a)(u,2),s=i[0],f=i[1],v=Object(n.useRef)(document.createElement("video")),b=Object(n.useRef)(p.TfLite.getInstance()),h=Object(n.useRef)(),k=Object(n.useState)(!1),g=Object(o.a)(k,2),j=g[0],E=g[1],y=Object(n.useState)([]),O=Object(o.a)(y,2),T=O[0],w=O[1],x=Object(n.useCallback)((function(e){var t=performance.now();b.current.process(v.current,!1,v.current.videoWidth,v.current.videoHeight),b.current.render();var a=performance.now()-t;h.current=window.setTimeout(x,Math.max(0,e-a),e)}),[]);function N(e,t){return S.apply(this,arguments)}function S(){return(S=Object(d.a)(m.a.mark((function e(t,a){var n,r,u,o,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.createMicrophoneAudioTrack(t);case 2:return n=e.sent,f(n),r=15,e.next=7,navigator.mediaDevices.getUserMedia({video:{frameRate:r,width:640,height:360}});case 7:return u=e.sent,v.current.autoplay=!0,v.current.onloadedmetadata=function(){b.current.canvas.width=v.current.videoWidth,b.current.canvas.height=v.current.videoHeight,x(1e3/r)},v.current.srcObject=u,o=b.current.canvas.captureStream(),e.next=14,l.a.createCustomVideoTrack({mediaStreamTrack:o.getVideoTracks()[0]});case 14:return i=e.sent,c(i),e.abrupt("return",[n,i]);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return(B=Object(d.a)(m.a.mark((function t(a,n,r,c){var u,i,l,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,N();case 4:return u=t.sent,i=Object(o.a)(u,2),l=i[0],s=i[1],t.next=10,e.join(a,n,r||null);case 10:return t.next=12,e.publish([l,s]);case 12:window.client=e,window.videoTrack=s,E(!0);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(){return(C=Object(d.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(h.current),s&&(s.stop(),s.close()),r&&(r.stop(),r.close()),v.current&&v.current.srcObject.getTracks().forEach((function(e){e.stop()})),w([]),E(!1),t.next=8,null===e||void 0===e?void 0:e.leave();case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(n.useEffect)((function(){if(e){w(e.remoteUsers);var t=function(){var t=Object(d.a)(m.a.mark((function t(a,n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.subscribe(a,n);case 2:w((function(t){return Array.from(e.remoteUsers)}));case 3:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),a=function(t){w((function(t){return Array.from(e.remoteUsers)}))},n=function(t){w((function(t){return Array.from(e.remoteUsers)}))},r=function(t){w((function(t){return Array.from(e.remoteUsers)}))};return e.on("user-published",t),e.on("user-unpublished",a),e.on("user-joined",n),e.on("user-left",r),function(){e.off("user-published",t),e.off("user-unpublished",a),e.off("user-joined",n),e.off("user-left",r)}}}),[e]),{localAudioTrack:s,localVideoTrack:r,joinState:j,leave:function(){return C.apply(this,arguments)},join:function(e,t,a,n){return B.apply(this,arguments)},changeBkg:function(e){if(b.current.blurBackground="blur"===e,"blur"!==e)if("black"===e)b.current.setBackground(p.TfLite.TRANSPARENT);else{b.current.blurBackground=!1;var t=new Image;t.onload=function(){b.current.setBackground(t)},t.src=e}},remoteUsers:T}}(v),O=y.localVideoTrack,T=y.leave,w=y.join,x=y.changeBkg,N=y.joinState,S=y.remoteUsers;return r.a.createElement("div",{className:"call"},r.a.createElement("form",{className:"call-form"},r.a.createElement("label",null,"AppID:",r.a.createElement("input",{type:"text",name:"appid",value:c,onChange:function(e){u(e.target.value)}})),r.a.createElement("label",null,"Token(Optional):",r.a.createElement("input",{type:"text",name:"token",value:b,onChange:function(e){h(e.target.value)}})),r.a.createElement("label",null,"Channel:",r.a.createElement("input",{type:"text",name:"channel",value:j,onChange:function(e){E(e.target.value)}})),r.a.createElement("div",null,"Background:",r.a.createElement("select",{name:"custom_bkg",id:"custom_bkg",defaultValue:"black",onChange:function(e){x(e.target.value)}},r.a.createElement("option",{value:"black"},"Black"),r.a.createElement("option",{value:"blur"},"Blur"),r.a.createElement("option",{value:"./images/V-CUBE.png"},"V-CUBE"),r.a.createElement("option",{value:"./images/bg_library.jpg"},"Library"),r.a.createElement("option",{value:"./images/bg_office.jpg"},"Office"),r.a.createElement("option",{value:"./images/bg_beach.jpeg"},"Beach"),r.a.createElement("option",{value:"./images/ems_country_cover_17.jpg"},"Nature"))),r.a.createElement("div",{className:"button-group"},r.a.createElement("button",{id:"join",type:"button",className:"btn btn-primary btn-sm",disabled:N,onClick:function(){w(c,j,b)}},"Join"),r.a.createElement("button",{id:"leave",type:"button",className:"btn btn-primary btn-sm",disabled:!N,onClick:function(){T()}},"Leave"))),r.a.createElement("div",{className:"player-container"},r.a.createElement("div",{className:"local-player-wrapper"},r.a.createElement("p",{className:"local-player-text"},O&&"localTrack",N&&O?"(".concat(v.uid,")"):""),r.a.createElement(f,{videoTrack:O,audioTrack:void 0})),S.map((function(e){return r.a.createElement("div",{className:"remote-player-wrapper",key:e.uid},r.a.createElement("p",{className:"remote-player-text"},"remoteVideo(".concat(e.uid,")")),r.a.createElement(f,{videoTrack:e.videoTrack,audioTrack:e.audioTrack}))}))))};u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(b,null)),document.getElementById("root"))},9:function(e,t,a){e.exports=a(19)}},[[9,1,2]]]);
//# sourceMappingURL=main.79a786ab.chunk.js.map