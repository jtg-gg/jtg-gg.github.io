!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(8),o=r(n(13)),a=r(n(14)),s=r(n(15)),u=r(n(16)),c=r(n(17));var l;!function(e){e[e.VIDEO_INPUT=0]="VIDEO_INPUT",e[e.VIDEO_MASK=1]="VIDEO_MASK",e[e.BACKGROUND=2]="BACKGROUND"}(l||(l={}));class f{constructor(e){this.isUsingBilateral=!1,this.textures=[],this.fragShaders=[],this.progs=[],this.frameBuffer=null,this.blurRenderTexture=null,this.maskRenderTexture=null,this.backgroundTextureSource=null,this.onWebGLContextLost=e=>{e.preventDefault(),this.destroy()},this.onWebGLContextRestored=()=>{this.initResources(),this.updateTexture(l.BACKGROUND,this.backgroundTextureSource)},this.gl=e,this.ext=e.getExtension("WEBGL_lose_context"),e.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost),e.canvas.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.initResources()}initResources(){const e=this.gl,t=e.createShader(e.VERTEX_SHADER);if(null==t)throw new Error("WebGLImageProcessing gl.createShader(gl.VERTEX_SHADER) fail");this.vertSh=t,this.prepareWebGL();const n=e.createBuffer();if(null==n)throw new Error("WebGLImageProcessing vertexBuffer = gl.createBuffer() fail");this.vertexBuffer=n,this.setArrays(),this.switchShader(0),i.strict(this.createTexture()==l.VIDEO_INPUT),i.strict(this.createTexture()==l.VIDEO_MASK),i.strict(this.createTexture()==l.BACKGROUND),this.frameBuffer=e.createFramebuffer(),this.frameBuffer&&(this.blurRenderTexture=this.createTextureRenderTarget(),this.maskRenderTexture=this.createTextureRenderTarget()),this.canvasViewport=[0,0,e.canvas.width,e.canvas.height]}destroy(){const e=this.gl;e.deleteShader(this.vertSh),this.fragShaders.forEach(t=>e.deleteShader(t)),this.fragShaders=[],this.progs.forEach(t=>e.deleteProgram(t)),this.progs=[],e.deleteBuffer(this.vertexBuffer),this.textures.forEach(t=>e.deleteTexture(t)),this.textures=[],e.deleteFramebuffer(this.frameBuffer),this.frameBuffer=null}prepareWebGL(){const e=this.gl;e.shaderSource(this.vertSh,c.default),e.compileShader(this.vertSh),console.log(e.getShaderInfoLog(this.vertSh)),this.fragShaders=[],this.progs=[],this.createFragmentShader(u.default),this.createFragmentShader(a.default),this.createFragmentShader(s.default),this.createFragmentShader(o.default)}createFragmentShader(e){const t=this.gl,n=t.createShader(t.FRAGMENT_SHADER);if(null==n)throw new Error("WebGLImageProcessing gl.createShader(gl.FRAGMENT_SHADER) fail");t.shaderSource(n,e),t.compileShader(n),console.log(t.getShaderInfoLog(n));const r=t.createProgram();if(null==r)throw new Error("WebGLImageProcessing gl.createProgram() fail");t.attachShader(r,this.vertSh),t.attachShader(r,n),t.linkProgram(r),this.fragShaders.push(n),this.progs.push(r)}setArrays(){const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1,1,-1,-1,1]),e.STATIC_DRAW);const t=e.getAttribLocation(this.progs[0],"coords");e.vertexAttribPointer(t,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t)}createTextureRenderTarget(){const e=this.gl,t=e.createTexture();if(null==t)return console.error("gl.createTexture() fail"),null;e.bindTexture(e.TEXTURE_2D,t);{const n=0,r=e.RGBA,i=0,o=e.RGBA,a=e.UNSIGNED_BYTE,s=null;e.texImage2D(e.TEXTURE_2D,n,r,192,192,i,o,a,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t.textureWidth=192,t.textureHeight=192}return this.textures.push(t),t}createTexture(){const e=this.gl,t=e.createTexture();if(null==t)return console.error("gl.createTexture() fail"),-1;const n=e.RGBA,r=e.RGBA,i=e.UNSIGNED_BYTE,o=new Uint8Array([0,0,255,255]);return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n,1,1,0,r,i,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),this.textures.push(t),this.textures.length-1}updateTexture(e,t,n=e){e==l.BACKGROUND&&(this.backgroundTextureSource=t);const r=this.textures[n];if(!r)return;const i=this.gl;i.activeTexture(i.TEXTURE0+e);const o=i.RGBA,a=i.RGBA,s=i.UNSIGNED_BYTE;i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,0,o,a,s,t),r.textureWidth=t.width||t.videoWidth,r.textureHeight=t.height||t.videoHeight}switchShader(e){const t=this.gl,n=this.progs[e];t.useProgram(n);const r=t.getUniformLocation(n,"uSampler"),i=t.getUniformLocation(n,"uAlpha"),o=t.getUniformLocation(n,"uBackground");t.uniform1i(r,l.VIDEO_INPUT),t.uniform1i(i,l.VIDEO_MASK),t.uniform1i(o,l.BACKGROUND)}filterMask(e){if(null==this.frameBuffer||null==this.maskRenderTexture)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);const n=t.COLOR_ATTACHMENT0;t.framebufferTexture2D(t.FRAMEBUFFER,n,t.TEXTURE_2D,this.maskRenderTexture,0),t.viewport(0,0,this.maskRenderTexture.textureWidth,this.maskRenderTexture.textureHeight),this.switchShader(this.isUsingBilateral?3:2),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.textures[e]),this.render(),this.switchShader(0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.maskRenderTexture),t.viewport(this.canvasViewport[0],this.canvasViewport[1],this.canvasViewport[2],this.canvasViewport[3])}blurBackground(e){if(null==this.frameBuffer||null==this.blurRenderTexture)return;const t=this.gl,n=this.textures[e];t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);const r=t.COLOR_ATTACHMENT0;t.framebufferTexture2D(t.FRAMEBUFFER,r,t.TEXTURE_2D,this.blurRenderTexture,0),t.viewport(0,0,this.blurRenderTexture.textureWidth,this.blurRenderTexture.textureHeight),this.switchShader(1);const i=t.getUniformLocation(this.progs[1],"vDIR");t.uniform2f(i,1,0),t.activeTexture(t.TEXTURE1);const o=t.getParameter(t.TEXTURE_BINDING_2D);t.bindTexture(t.TEXTURE_2D,n),this.render(),t.framebufferTexture2D(t.FRAMEBUFFER,r,t.TEXTURE_2D,n,0),t.uniform2f(i,0,1),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.blurRenderTexture),t.viewport(0,0,n.textureWidth,n.textureHeight),this.render(),this.switchShader(0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this.textures[e]),t.viewport(this.canvasViewport[0],this.canvasViewport[1],this.canvasViewport[2],this.canvasViewport[3])}render(){const e=this.gl;e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,6)}setViewPort(e,t,n,r){this.canvasViewport=[e,t,n,r],this.gl.viewport(e,t,n,r)}}t.default=f,f.Textures=l},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&h())}function h(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";t.a=function(){return new Worker(n.p+"bundle.worker.js")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e,t){this.lastTick=performance.now(),this.lastNotify=this.lastTick,this.interval=e,this.element=t,this.runningSum=0,this.runningSamples=0}tick(){const e=performance.now();this.runningSum+=e-this.lastTick,this.runningSamples++,this.lastTick=e,e-this.lastNotify>this.interval&&this.notify(e)}notify(e){const t=1e3/(this.runningSum/this.runningSamples);this.element.innerText=t.toFixed(2)+"fps",this.lastNotify=e,this.runningSamples=0,this.runningSum=0}}},function(e,t,n){"use strict";n.r(t),function(e){var t=n(3),r=n(4),i=n(1),o=n.n(i);const a={canvas:{video:document.getElementById("video"),hidden:document.createElement("canvas"),visible:document.getElementById("canvas"),capture:document.getElementById("capture"),template:document.getElementById("template"),ctx:{}},audio:{shutter:document.getElementById("shutter")},downloadBtn:document.getElementById("btn-download"),loading:document.getElementById("loading"),fps:document.getElementById("fps")},s=window.location.search,u=new URLSearchParams(s),c=Number(u.get("width")),l=Number(u.get("height"));let f=192,d=192;a.canvas.hidden.width=f,a.canvas.hidden.height=d,a.canvas.ctx.hidden=a.canvas.hidden.getContext("2d");const h=a.canvas.visible.getContext("webgl");console.log(h),a.canvas.ctx.capture=a.canvas.capture.getContext("2d"),a.canvas.ctx.capture.drawImage(a.canvas.template,0,0);const p=o.a.Textures,g=new o.a(h);a.canvas.video.addEventListener("loadedmetadata",(function(){const e=document.getElementsByClassName("video")[0];e.style.width=1*this.videoWidth+"px",e.style.height=1*this.videoHeight+"px",a.canvas.visible.width=1*this.videoWidth,a.canvas.visible.height=1*this.videoHeight,g.setViewPort(0,0,1*this.videoWidth,1*this.videoHeight),b()}),!1);const m=document.getElementById("custom_bkg");m.addEventListener("change",(function(){const e=this.value;if("black"==e)g.updateTexture(p.BACKGROUND,new ImageData(new Uint8ClampedArray([0,0,0,255]),1,1));else if("blur"==e);else{const t=new Image;t.onload=function(){g.updateTexture(p.BACKGROUND,t)},t.src=e}}),!1),m.dispatchEvent(new Event("change")),a.downloadBtn.addEventListener("click",(function(t){let n=3;a.loading.innerText="";const r=()=>{0!==n?(a.downloadBtn.innerText="... "+n.toString()+" ...",setTimeout(()=>{n--,r()},1e3)):e(()=>{a.downloadBtn.innerText="CAPTURE",a.canvas.visible.classList.add("flash"),a.canvas.ctx.capture.drawImage(a.canvas.visible,25,25);var e=a.canvas.capture.toDataURL("image/png");const t=document.createElement("a");t.href=e,t.download="wasmbooth.png",setTimeout(()=>a.canvas.visible.classList.remove("flash"),1e3);var n=new MouseEvent("click");t.dispatchEvent(n)})};r(),t.preventDefault()})),navigator.mediaDevices.getUserMedia({video:{width:c,height:l},audio:!1}).then((function(e){a.canvas.video.srcObject=e})).catch((function(e){throw e})),window.sounds=(()=>{var e=window.AudioContext||window.webkitAudioContext||!1;if(e){var t=new e;return{beep:(()=>{const e=t.createOscillator(),n=t.createGain();return n.gain.value=0,e.type="sine",e.connect(n),e.frequency.value=830.6,n.connect(t.destination),e.start(0),()=>{n.gain.value=.1,setTimeout(()=>n.gain.value=0,150)}})(),shutter:()=>{a.audio.shutter.play()}}}return{beep:()=>{},shutter:()=>{}}})();const v=()=>{"blur"==m.value&&g.blurBackground(p.VIDEO_MASK),g.filterMask(p.VIDEO_MASK),g.render(),b()},T=new t.a;T.postMessage({eventType:"INITIALISE"}),T.addEventListener("message",(function(e){const{eventType:t,eventData:n}=e.data;if("INFERENCE_RESULT"===t){const e=new ImageData(new Uint8ClampedArray(n[0]),n[1],n[2]);g.updateTexture(p.VIDEO_MASK,e),E?v():requestAnimationFrame(v)}else"ERROR"===t&&console.error(e)})),T.addEventListener("error",(function(e){console.error(e)})),document.getElementById("lite_model_on").addEventListener("change",(function(){f=this.checked?128:192,d=this.checked?128:192})),document.getElementById("bilateral_on").addEventListener("change",(function(){console.log("bilateral_on("+this.checked+")"),g.isUsingBilateral=this.checked}));let E=!1;document.getElementById("fullspeed_on").addEventListener("change",(function(){console.log("fullspeed_on("+this.checked+")"),E=this.checked}));const y=new r.a(1e3,a.fps),b=()=>{if(y.tick(),g.updateTexture(p.VIDEO_INPUT,a.canvas.video),void 0!==window.OffscreenCanvas)createImageBitmap(a.canvas.video,{resizeHeight:f,resizeWidth:d}).then(e=>{T.postMessage({eventType:"CALL",eventData:{method:"RUN_INFERENCE",arguments:[e,f,d]}},[e])});else{a.canvas.ctx.hidden.drawImage(a.canvas.video,0,0,a.canvas.video.videoWidth,a.canvas.video.videoHeight,0,0,f,d);const e=a.canvas.ctx.hidden.getImageData(0,0,f,d);T.postMessage({eventType:"CALL",eventData:{method:"RUN_INFERENCE",arguments:[e.data.buffer,f,d]}},[e.data.buffer])}}}.call(this,n(6).setImmediate)},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(7),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,a,s,u=1,c={},l=!1,f=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){o.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(e){var t=f.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&p(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(a+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[u]=i,r(u),u++},d.clearImmediate=h}function h(e){delete c[e]}function p(e){if(l)setTimeout(p,0,e);else{var t=c[e];if(t){l=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{h(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(2))},function(e,t,n){"use strict";(function(t){var r=n(9);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function i(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function o(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=n(10),s=Object.prototype.hasOwnProperty,u=Array.prototype.slice,c="foo"===function(){}.name;function l(e){return Object.prototype.toString.call(e)}function f(e){return!o(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var d=e.exports=T,h=/\s*function\s+([^\(\s]*)\s*/;function p(e){if(a.isFunction(e)){if(c)return e.name;var t=e.toString().match(h);return t&&t[1]}}function g(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(c||!a.isFunction(e))return a.inspect(e);var t=p(e);return"[Function"+(t?": "+t:"")+"]"}function v(e,t,n,r,i){throw new d.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function T(e,t){e||v(e,!0,t,"==",d.ok)}function E(e,t,n,r){if(e===t)return!0;if(o(e)&&o(t))return 0===i(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(f(e)&&f(t)&&l(e)===l(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;var s=(r=r||{actual:[],expected:[]}).actual.indexOf(e);return-1!==s&&s===r.expected.indexOf(t)||(r.actual.push(e),r.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=y(e),o=y(t);if(i&&!o||!i&&o)return!1;if(i)return e=u.call(e),t=u.call(t),E(e,t,n);var s,c,l=w(e),f=w(t);if(l.length!==f.length)return!1;for(l.sort(),f.sort(),c=l.length-1;c>=0;c--)if(l[c]!==f[c])return!1;for(c=l.length-1;c>=0;c--)if(s=l[c],!E(e[s],t[s],n,r))return!1;return!0}(e,t,n,r))}return n?e===t:e==t}function y(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function b(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function x(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&v(i,n,"Missing expected exception"+r);var o="string"==typeof r,s=!e&&i&&!n;if((!e&&a.isError(i)&&o&&b(i,n)||s)&&v(i,n,"Got unwanted exception"+r),e&&i&&n&&!b(i,n)||!e&&i)throw i}d.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return g(m(e.actual),128)+" "+e.operator+" "+g(m(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=p(t),o=r.indexOf("\n"+i);if(o>=0){var a=r.indexOf("\n",o+1);r=r.substring(a+1)}this.stack=r}}},a.inherits(d.AssertionError,Error),d.fail=v,d.ok=T,d.equal=function(e,t,n){e!=t&&v(e,t,n,"==",d.equal)},d.notEqual=function(e,t,n){e==t&&v(e,t,n,"!=",d.notEqual)},d.deepEqual=function(e,t,n){E(e,t,!1)||v(e,t,n,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(e,t,n){E(e,t,!0)||v(e,t,n,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(e,t,n){E(e,t,!1)&&v(e,t,n,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function e(t,n,r){E(t,n,!0)&&v(t,n,r,"notDeepStrictEqual",e)},d.strictEqual=function(e,t,n){e!==t&&v(e,t,n,"===",d.strictEqual)},d.notStrictEqual=function(e,t,n){e===t&&v(e,t,n,"!==",d.notStrictEqual)},d.throws=function(e,t,n){x(!0,e,t,n)},d.doesNotThrow=function(e,t,n){x(!1,e,t,n)},d.ifError=function(e){if(e)throw e},d.strict=r((function e(t,n){t||v(t,!0,n,"==",e)}),d,{equal:d.strictEqual,deepEqual:d.deepStrictEqual,notEqual:d.notStrictEqual,notDeepEqual:d.notDeepStrictEqual}),d.strict.strict=d.strict;var w=Object.keys||function(e){var t=[];for(var n in e)s.call(e,n)&&t.push(n);return t}}).call(this,n(0))},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,u=a(e),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))i.call(n,l)&&(u[l]=n[l]);if(r){s=r(n);for(var f=0;f<s.length;f++)o.call(n,s[f])&&(u[s[f]]=n[s[f]])}}return u}},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,a=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),u=r[n];n<o;u=r[++n])g(u)||!y(u)?a+=" "+u:a+=" "+s(u);return a},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var o,a={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),T(r.showHidden)&&(r.showHidden=!1),T(r.depth)&&(r.depth=2),T(r.colors)&&(r.colors=!1),T(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),l(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=l(e,i,r)),i}var o=function(e,t){if(T(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(m(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,n);if(o)return o;var a=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),x(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return f(n);if(0===a.length){if(w(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(E(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return e.stylize(Date.prototype.toString.call(n),"date");if(x(n))return f(n)}var c,y="",S=!1,R=["{","}"];(h(n)&&(S=!0,R=["[","]"]),w(n))&&(y=" [Function"+(n.name?": "+n.name:"")+"]");return E(n)&&(y=" "+RegExp.prototype.toString.call(n)),b(n)&&(y=" "+Date.prototype.toUTCString.call(n)),x(n)&&(y=" "+f(n)),0!==a.length||S&&0!=n.length?r<0?E(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=S?function(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)A(t,String(a))?o.push(d(e,t,n,r,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(d(e,t,n,r,i,!0))})),o}(e,n,r,s,a):a.map((function(t){return d(e,n,r,s,t,S)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,y,R)):R[0]+y+R[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),A(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=g(n)?l(e,u.value,null):l(e,u.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),T(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function h(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function v(e){return"string"==typeof e}function T(e){return void 0===e}function E(e){return y(e)&&"[object RegExp]"===S(e)}function y(e){return"object"==typeof e&&null!==e}function b(e){return y(e)&&"[object Date]"===S(e)}function x(e){return y(e)&&("[object Error]"===S(e)||e instanceof Error)}function w(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function R(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(T(o)&&(o=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!a[n])if(new RegExp("\\b"+n+"\\b","i").test(o)){var r=e.pid;a[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else a[n]=function(){};return a[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=p,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=T,t.isRegExp=E,t.isObject=y,t.isDate=b,t.isError=x,t.isFunction=w,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(11);var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function _(){var e=new Date,t=[R(e.getHours()),R(e.getMinutes()),R(e.getSeconds())].join(":");return[e.getDate(),D[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",_(),t.format.apply(t,arguments))},t.inherits=n(12),t._extend=function(e,t){if(!t||!y(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var I="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function O(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(I&&e[I]){var t;if("function"!=typeof(t=e[I]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,I,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),I&&Object.defineProperty(t,I,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=I,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return i.apply(o,arguments)};t.apply(this,n).then((function(t){e.nextTick(a,null,t)}),(function(t){e.nextTick(O,t,a)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(2))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";n.r(t),t.default="// Setting precision for float calculations\nprecision mediump float;\n\n// This is input from vertex shader\nvarying highp vec2 vTextureCoord;\n\n// Samplers are needeed to select textures\n// actually its integers\nuniform sampler2D uSampler;\nuniform sampler2D uAlpha;\n\n#define SIGMA 2.0\n#define BSIGMA 1.0\n#define MSIZE 3\n\nfloat normpdf(in float x, in float sigma)\n{\n    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n}\n\nfloat normpdf3(in vec3 v, in float sigma)\n{\n    return 0.39894*exp(-0.5*dot(v,v)/(sigma*sigma))/sigma;\n}\n\nfloat normpdf4(in vec4 v, in float sigma)\n{\n    return 0.39894*exp(-0.5*dot(v,v)/(sigma*sigma))/sigma;\n}\n\nvoid main(void) {\n\n    // Transforming coordinates from GL space to texture space\n    // All math can be done directly to vectors\n    vec2 fragCoord = vTextureCoord / 2.0 + 0.5;\n    fragCoord = 1.0 - fragCoord;\n    const vec2 iResolution = vec2(192.0, 192.0);\n\n    vec4 c = texture2D(uAlpha, fragCoord.xy);\n\n    //declare stuff\n    const int kSize = (MSIZE-1)/2;\n    float kernel[MSIZE];\n    vec4 final_colour = vec4(0.0);\n    \n    //create the 1-D kernel\n    float Z = 0.0;\n    for (int j = 0; j <= kSize; ++j)\n    {\n        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), SIGMA);\n    }\n    \n    \n    vec4 cc;\n    float factor;\n    float bZ = 1.0/normpdf(0.0, BSIGMA);\n    //read out the texels\n    for (int i=-kSize; i <= kSize; ++i)\n    {\n        for (int j=-kSize; j <= kSize; ++j)\n        {\n            cc = texture2D(uAlpha, fragCoord.xy + vec2(float(i),float(j)) / iResolution.xy);\n            //factor = normpdf4(cc-c, BSIGMA)*bZ*kernel[kSize+j]*kernel[kSize+i];\n            factor = normpdf3(cc.rgb-c.rgb, BSIGMA)*bZ*kernel[kSize+j]*kernel[kSize+i];\n            //factor = normpdf(cc.a-c.a, BSIGMA)*bZ*kernel[kSize+j]*kernel[kSize+i];\n            Z += factor;\n            final_colour += factor*cc;\n\n        }\n    }\n    \n    gl_FragColor = final_colour/Z;\t\n}\n"},function(e,t,n){"use strict";n.r(t),t.default="// Setting precision for float calculations\nprecision mediump float;\n\n// This is input from vertex shader\nvarying highp vec2 vTextureCoord;\n\n// Samplers are needeed to select textures\n// actually its integers\nuniform sampler2D uSampler;\nuniform sampler2D uAlpha;\nuniform vec2 vDIR;\n\nconst float PI = 3.1415926535897932384626433832795;\nconst int blur_size = 3;\nconst float blur_width = 1.;\n\nfloat gauss(float x, float e)\n{\n    return 1.0/(pow(2.0*PI*e*e, 0.5)) * exp(-(x*x)/(2.0*e*e)); \n}\n\nvoid main(void) {\n\n    // Transforming coordinates from GL space to texture space\n    // All math can be done directly to vectors\n    vec2 coords = vTextureCoord / 2.0 + 0.5;\n    coords = 1.0 - coords;\n\t\n\tvec4 pixval = vec4(0.);\n\tfloat tot = 0.;\n\n\tconst int nb = 2*blur_size+1;\n\n\tfor (int x=0; x<nb; x++)\n\t{ \n\t   float x2 = blur_width*float(x-blur_size);\n\t   vec2 ipos = coords + vDIR * (x2 / 192.0);\n\t   float g = gauss(x2, float(blur_size) * blur_width);\n\t   pixval+= g*texture2D(uAlpha, ipos);\n\t   tot+= g;\n\t}\n\tgl_FragColor = pixval/tot;\n}\n"},function(e,t,n){"use strict";n.r(t),t.default="// Setting precision for float calculations\nprecision mediump float;\n\n// This is input from vertex shader\nvarying highp vec2 vTextureCoord;\n\n// Samplers are needeed to select textures\n// actually its integers\nuniform sampler2D uSampler;\nuniform sampler2D uAlpha;\n\nvec2 coords;\nvec4 background;\nvoid main(void) {\n\n    // Transforming coordinates from GL space to texture space\n    // All math can be done directly to vectors\n    coords = vTextureCoord / 2.0 + 0.5;\n    coords = 1.0 - coords;\n\n\tbackground = texture2D(uAlpha, coords);\n\t\n    const float PI = 6.28318530718; // Pi*2\n    \n    // GAUSSIAN BLUR SETTINGS {{{\n    const float DIR = 4.0; // BLUR DIRECTIONS (Default 16.0 - More is better but slower)\n    const float QLT = 2.0; // BLUR QUALITY (Default 3.0 - More is better but slower)\n    const float SIZE = 2.0; // BLUR SIZE (Radius Default 8.0)\n    // GAUSSIAN BLUR SETTINGS }}}\n   \n    const vec2 RAD = SIZE/vec2(192.0, 192.0);\n    \n    // Blur calculations\n    for( float d=0.0; d<PI; d+=PI/DIR)\n    {\n\t\tfor(float i=1.0/QLT; i<=1.0; i+=1.0/QLT)\n        {\n\t\t\tbackground += texture2D( uAlpha, coords+vec2(cos(d),sin(d))*RAD*i);\t\t\n        }\n    }\n    \n    // Output to screen\n    background /= QLT * DIR;\n\n\t// Fragment shader must set this variable\n\tgl_FragColor = background;\n}\n"},function(e,t,n){"use strict";n.r(t),t.default="// Setting precision for float calculations\nprecision mediump float;\n// This is input from vertex shader\nvarying highp vec2 vTextureCoord;\n// Samplers are needeed to select textures\n// actually its integers\nuniform sampler2D uSampler;\nuniform sampler2D uAlpha;\nuniform sampler2D uBackground;\n\nvec2 coords;\nvec4 background;\nfloat alpha;\nvoid main(void){\n\n    // Transforming coordinates from GL space to texture space\n    // All math can be done directly to vectors\n    coords = vTextureCoord / 2.0 + 0.5;\n    coords.x = 1.0 - coords.x;\n\n    alpha = texture2D(uAlpha, coords).a;\n    //transform alpha value 0.5 - 1.0 --\x3e 0.0 --\x3e 1.0  \n    //alpha = clamp(alpha * 2.0 - 1.0, 0.0, 1.0);\n\n    background = texture2D(uBackground, coords);\n    background.a = 1.0;\n\n    // Fragment shader must set this variable\n    gl_FragColor = texture2D(uSampler, coords) * alpha + (1.0 - alpha) * background;\n}"},function(e,t,n){"use strict";n.r(t),t.default="// This is our input from js world\nattribute vec2 coords;\n// This is output for the fragment shader\n// varying variables are a little special\n// you will see why later\nvarying highp vec2 vTextureCoord;\n\nvoid main (void) {\n    // Texture and verticies have different coordinate spaces\n    // we do this to invert Y axis\n    vTextureCoord = -coords;\n\n    // Setting vertix position for shape assembler \n    // GLSL has many convenient vector functions\n    // here we extending 2D coords vector to 4D with 2 values\n    // 0.0 is a Z coordinate\n    // 1.1 is a W, special value needed for 3D math\n    // just leave it 1 for now\n    gl_Position = vec4(coords, 0.0, 1.0);\n}"}]);