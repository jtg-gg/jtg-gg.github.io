(this["webpackJsonpreact-demo"]=this["webpackJsonpreact-demo"]||[]).push([[0],{14:function(e,t,n){"use strict";(function(e){var r=n(2),a=n.n(r),o=n(3),c=n(18),i=n(1),u=n(0),l=n.n(u),s=n(15),f=n.n(s),d=n(16),m=n(17),v=(n(52),window.require?window.require("fs"):null),p=window.require?window.require("process"):null;null===p||void 0===p||p.on("SIGINT",(function(){var e;console.log("process on SIGINT"),null===(e=document.getElementById("leave"))||void 0===e||e.click()})),"undefined"!==typeof nw&&nw.Screen.Init();var h=function(e){var t=window.location.search,n=new URLSearchParams(t).get(e);return n||""};"1"===h("join")&&setTimeout((function(){var e;null===(e=document.getElementById("join"))||void 0===e||e.click()}),2e3);var b=[1,2],g=b.map((function(){return f.a.createClient({codec:"h264",mode:"rtc"})}));console.log("outside function Call"),t.a=function(){console.log("inside function Call");var t=Object(u.useState)(h("appid")),n=Object(i.a)(t,2),r=n[0],s=n[1],f=Object(u.useState)(h("token")),p=Object(i.a)(f,2),w=p[0],j=p[1],E=Object(u.useState)(b.map((function(e){return h("channel"+e)}))),y=Object(i.a)(E,2),O=y[0],k=y[1],S=Object(u.useState)(Number(h("fps"))||-15),x=Object(i.a)(S,2),M=x[0],C=x[1],R=Object(u.useState)("NO"),T=Object(i.a)(R,2),I=T[0],N=T[1],U=g.map(d.a),D=Object(m.a)(g),A=Object(u.useMemo)((function(){var e=[];return U.forEach((function(t){return e=e.concat(t.remoteUsers)})),e}),[U]),B=Object(u.useRef)(null),q=Object(u.useRef)(null),F=Object(u.useRef)([]),L=function(t){console.log(t.getVideoTracks()[0].getSettings());var n=null;n=nw.MediaRecorder?new nw.MediaRecorder(t,"video/mp4"):new MediaRecorder(t,{mimeType:"video/webm; codecs=vp8"}),B.current=n,F.current=[],n.ondataavailable=function(t){t.data.size>0&&(console.log(t),q.current?t.data.arrayBuffer().then((function(t){return q.current.write(e.from(t))})):F.current.push(t.data))},n.start(1e3,{videoParams:"preset=ultrafast"})};Object(u.useEffect)((function(){console.log("useEffect FPS, allChannelRemoteUsers"),A.forEach((function(e){var t;null===(t=e.videoTrack)||void 0===t||t.getMediaStreamTrack().applyConstraints({frameRate:Math.abs(M)})}))}),[M,A]);var V=Object(u.useRef)(document.createElement("div"));Object(u.useEffect)((function(){console.log("useEffect play videotrack [allChannelRemoteUsers]"),A.forEach((function(e){var t;if(null===(t=e.audioTrack)||void 0===t||t.play(),e.videoTrack){for(var n=D.maxSpeaker<=0,r=0;r<D.remoteVolumes.length&&!n;r++)n=e.uid===D.remoteVolumes[r].uid;if(n)V.current.querySelector("#video_"+e.videoTrack.getTrackId())||e.videoTrack.play(V.current);else e.videoTrack.stop()}}))})),Object(u.useEffect)((function(){if(console.log("useEffect draw canvas / video element [fps]"),U[0].joinState){clearTimeout(P.current);var e=document.getElementById("recodingDiv");if(M>0)W(M);else{for(var t=Math.ceil(Math.sqrt(V.current.children.length)),n=e.offsetWidth/t+"px",r=e.offsetHeight/t+"px",a=0;a<V.current.children.length;a++){var o=V.current.children[a];o.style.width=n,o.style.height=r,o.style.float="left"}e.contains(V.current)||e.appendChild(V.current)}}}));var P=Object(u.useRef)(0),W=function e(t){var n=document.getElementById("recordingCanvas");if(n){var r=n.getContext("2d");r.fillStyle="hsl(0, 0%, 95%)",r.fillRect(0,0,n.width,n.height);for(var a=A,o=Math.ceil(Math.sqrt(a.length)),c=n.width/o,i=n.height/o,u=0;u<o;u++)for(var l=0;l<o;l++){var s=l*o+u;if(s>=a.length)break;var f=a[s].videoTrack;if(f){var d=V.current.querySelector("#video_"+f.getTrackId());d&&r.drawImage(d,u*c,l*i,c,i)}}P.current=setTimeout(e,1e3/t,t)}else P.current=setTimeout(e,1e3/t,t)};return l.a.createElement("div",{className:"call"},l.a.createElement("form",{className:"call-form"},l.a.createElement("label",null,"AppID:",l.a.createElement("input",{type:"text",name:"appid",value:r,onChange:function(e){s(e.target.value)}})),l.a.createElement("label",null,"Token(Optional):",l.a.createElement("input",{type:"text",name:"token",value:w,onChange:function(e){j(e.target.value)}})),b.map((function(e,t){return l.a.createElement("label",{key:t},"Channel",e," ",l.a.createElement("input",{type:"text",name:"channel"+e,value:O[t],onChange:function(e){return function(e,t){var n=Object(c.a)(O);n[e]=t,k(n)}(t,e.target.value)}}))})),l.a.createElement("label",null,"FPS:",l.a.createElement("input",{type:"number",name:"fps",value:M,onChange:function(e){var t=Number(e.target.value);console.log("setFps:"+t),C(t)}})),l.a.createElement("label",null,"Recording Mode:",l.a.createElement("select",{value:I,onChange:function(e){N(e.target.value)}},l.a.createElement("option",{value:"NO"},"No"),l.a.createElement("option",{value:"TAB"},"Tab"),l.a.createElement("option",{value:"DCM"},"nw.dcm"),l.a.createElement("option",{value:"DISPLAYMEDIA"},"getDisplayMedia"))),l.a.createElement("label",null,"MaxVideo:",l.a.createElement("input",{type:"number",name:"maxVideo",value:D.maxSpeaker,onChange:function(e){var t=Number(e.target.value);console.log("setMaxVideo:"+t),D.setMaxSpeaker(t)}})),l.a.createElement("div",{className:"button-group"},l.a.createElement("button",{id:"join",type:"button",className:"btn btn-primary btn-sm",disabled:U[0].joinState,onClick:function(){if(console.log("==== join is executed ====="),g.forEach((function(e){return e.enableAudioVolumeIndicator()})),U.forEach((function(e,t){return e.join(r,O[t],w)})),"NO"!==I)if("chrome-extension:"===window.location.protocol&&(q.current=v.createWriteStream(nw.MediaRecorder?"test.mp4":"test.webm")),"chrome-extension:"===window.location.protocol&&"TAB"===I)chrome.tabCapture.capture({video:!0,audio:!0,videoConstraints:{mandatory:{minFrameRate:Math.abs(M),maxFrameRate:Math.abs(M),minWidth:window.innerWidth,maxWidth:window.innerWidth,minHeight:window.innerHeight,maxHeight:window.innerHeight}}},(function(e){null!==e?L(e):console.error("chrome.tabCapture fail")}));else if("undefined"!==typeof nw&&"DCM"===I){var e=nw.Screen.DesktopCaptureMonitor;e.once("added",function(){var t=Object(o.a)(a.a.mark((function t(n,r,o,c){var i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log(n+", "+r+", "+o+", "+c),"Agora Recorder"===r){e.stop(),i={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.registerStream(n),minFrameRate:Math.abs(M),maxFrameRate:Math.abs(M)}}};try{window.navigator.mediaDevices.getUserMedia(i).then(L)}catch(a){console.error(a)}}case 2:case"end":return t.stop()}}),t)})));return function(e,n,r,a){return t.apply(this,arguments)}}()),e.start(!1,!0)}else{navigator.mediaDevices.getDisplayMedia({video:{frameRate:Math.abs(M)},audio:!0}).then(L)}}},"Join"),l.a.createElement("button",{id:"leave",type:"button",className:"btn btn-primary btn-sm",disabled:!U[0].joinState,onClick:function(){if(U.forEach((function(e){return e.leave()})),V.current=document.createElement("div"),clearTimeout(P.current),B.current)if(B.current.stop(),B.current.stream.getTracks().forEach((function(e){return e.stop()})),q.current)q.current.end(),q.current=null;else{var t=new Blob(F.current,{type:"video/webm"});if(v)t.arrayBuffer().then((function(t){return v.writeFileSync("./test.webm",e.from(t))}));else{var n=URL.createObjectURL(t),r=document.createElement("a");document.body.appendChild(r),r.href=n,r.download="test.webm",r.click(),window.URL.revokeObjectURL(n)}}}},"Leave"))),l.a.createElement("div",{className:"player-container"},M>0?l.a.createElement("canvas",{id:"recordingCanvas",width:1280,height:720}," "):l.a.createElement("div",{id:"recodingDiv",style:{width:1280,height:720}})))}}).call(this,n(26).Buffer)},16:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(2),a=n.n(r),o=n(3),c=n(1),i=n(0);function u(e){var t=Object(i.useState)(!1),n=Object(c.a)(t,2),r=n[0],u=n[1],l=Object(i.useState)([]),s=Object(c.a)(l,2),f=s[0],d=s[1],m=Object(i.useCallback)(function(){var t=Object(o.a)(a.a.mark((function t(n,r,o,c){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.join(n,r,o||null);case 4:u(!0);case 5:case"end":return t.stop()}}),t)})));return function(e,n,r,a){return t.apply(this,arguments)}}(),[e]),v=Object(i.useCallback)(Object(o.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d([]),u(!1),t.next=4,null===e||void 0===e?void 0:e.leave();case 4:case"end":return t.stop()}}),t)}))),[e]);return Object(i.useEffect)((function(){if(e){d(e.remoteUsers);var t=function(){var t=Object(o.a)(a.a.mark((function t(n,r){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.subscribe(n,r);case 2:d((function(t){return Array.from(e.remoteUsers)}));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),n=function(t){d((function(t){return Array.from(e.remoteUsers)}))},r=function(t){d((function(t){return Array.from(e.remoteUsers)}))},c=function(t){d((function(t){return Array.from(e.remoteUsers)}))};return e.on("user-published",t),e.on("user-unpublished",n),e.on("user-joined",r),e.on("user-left",c),function(){e.off("user-published",t),e.off("user-unpublished",n),e.off("user-joined",r),e.off("user-left",c)}}}),[e]),{joinState:r,leave:v,join:m,remoteUsers:f}}},17:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),a=n(0);function o(e){var t=Object(a.useState)([]),n=Object(r.a)(t,2),o=n[0],c=n[1],i=Object(a.useState)(Number(function(e){var t=window.location.search,n=new URLSearchParams(t).get(e);return n||""}("maxvideo"))||0),u=Object(r.a)(i,2),l=u[0],s=u[1],f=Object(a.useRef)([]);return Object(a.useEffect)((function(){var t=function(t,n){if(f.current.length<e.length)for(var r=0;r<e.length;r++)f.current.push([]);f.current[t]=n;var a=f.current.flat();a.sort((function(e,t){return e.level===t.level?String(t.uid).localeCompare(String(e.uid)):t.level-e.level})),a=a.slice(0,l);for(var i=o.length===a.length,u=0;u<o.length&&i;u++)i=o[u].uid===a[u].uid;i||c(a)};return l>0&&e.forEach((function(e,n){return e.on("volume-indicator",(function(e){t(n,e)}))})),function(){l>0&&e.forEach((function(e,n){return e.off("volume-indicator",(function(e){t(n,e)}))})),c([])}}),[e,l]),{remoteVolumes:o,maxSpeaker:l,setMaxSpeaker:s}}},19:function(e,t,n){e.exports=n(20)},20:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(13),c=n.n(o),i=(n(25),n(14));c.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(i.a,null)),document.getElementById("root"))},25:function(e,t,n){},52:function(e,t,n){}},[[19,1,2]]]);
//# sourceMappingURL=main.cb123e32.chunk.js.map